<?xml version="1.0"?>
<project name="jscombine" default="minify" basedir="..">

  <!-- 
    Javascript minifier and concatenator Ant build script
    Author: Chris Batchelor, @FiregobyDesign
    Credits: Based on code from HTML5Boilerplate, all glory goes
    to Paul Irish and co with thanks, any bugs are probably me ;o)
  -->

  <!-- 
    Javascript filelist, the order here is maintained so if one
    script depends upon another place it higher in the list.

    Include CoffeeScript files using their compiled .js extension
    All .coffee files are compiled first, see target#coffescript

    To include Bootstrap JS files, reference the bootstrap folder
      e.g. <file name="../bootstrap/js/bootstrap-alert.js"/>
  -->
  <filelist id="filelist" dir=".">
    <file name="../bootstrap/js/bootstrap-transition.js"/>
    <file name="../bootstrap/js/bootstrap-alert.js"/>
    <file name="../bootstrap/js/bootstrap-modal.js"/>
    <file name="../bootstrap/js/bootstrap-dropdown.js"/>
    <file name="../bootstrap/js/bootstrap-scrollspy.js"/>
    <file name="../bootstrap/js/bootstrap-tab.js"/>
    <file name="../bootstrap/js/bootstrap-tooltip.js"/>
    <file name="../bootstrap/js/bootstrap-popover.js"/>
    <file name="../bootstrap/js/bootstrap-button.js"/>
    <file name="../bootstrap/js/bootstrap-collapse.js"/>
    <file name="../bootstrap/js/bootstrap-carousel.js"/>
    <file name="../bootstrap/js/bootstrap-typeahead.js"/>
    <file name="plugins.js" />
    <file name="main.js" />
  </filelist>

  <!-- Minify production.js to production.min.js using YUICompressor -->
  <target name="minify" depends="concatenate">
    <echo message="Minifying javascript..."/>
    <apply executable="java" parallel="false">
      <filelist dir="." files="production.js"/>
      <arg line="-jar"/>
      <arg path="build/yuicompressor-2.4.6.jar"/>
      <srcfile/>
      <arg line="--line-break 4000"/>
      <arg line="--nomunge"/>
      <arg line="--preserve-semi"/>
      <arg line="--disable-optimizations"/>
      <arg line="-o"/>
      <mapper type="glob" from="*.js" to="../*.min.js"/>
      <targetfile/>
    </apply>
  </target>

  <!-- Concatenate all filelist filenames into a single production.js file -->
  <target name="concatenate" depends="coffeescript" description="Concatenate all js files">
    <echo message="Concatenating javascripts into production.js..."/>
    <concat destfile="production.js" encoding="UTF-8" outputencoding="UTF-8" fixlastline="true">
      <filelist refid="filelist" />
    </concat>
  </target>

  <!-- Compile any CoffeeScript files first -->
  <target name="coffeescript">
    <echo message="Compiling Coffeescript..."/>
    <apply executable="coffee" parallel="false">
      <fileset dir=".">
        <include name="**/*.coffee"/>
      </fileset>
      <arg line="-cl"/>
      <srcfile/>
    </apply>
  </target>

</project>
